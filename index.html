<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Star Wars</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <main class="bg-slate-900 min-h-screen">
      <section>
        <div class="relative items-center w-full px-5 py-12 mx-auto md:px-12 lg:px-16 max-w-7xl lg:py-24">
          <div class="flex w-full mx-auto text-left">
            <div class="relative inline-flex items-center mx-auto align-middle">
              <div class="text-center">
                <h1 class="max-w-5xl text-2xl font-bold leading-none tracking-tighter text-amber-300 md:text-5xl lg:text-6xl lg:max-w-7xl">
                  In a galaxy far, far away...
                </h1>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="p-6">
        <h2 class="text-stone-50 text-4xl font-semibold">Vehicles</h2>
        <div id="vehicles" class="grid w-full grid-cols-1 gap-12 mx-auto lg:grid-cols-3"></div>
      </section>

      <section class="p-6">
        <h2 class="text-stone-50 text-4xl font-semibold">Starships</h2>
        <div id="starships" class="grid w-full grid-cols-1 gap-12 mx-auto lg:grid-cols-3"></div>
      </section>
    </main>
    <script>
      function delay() {
        return new Promise((resolve) => setTimeout(resolve, 1000));
      }

      function el(type, children, className) {
        const el = document.createElement(type);
        if (children) el.append(...children);
        if (className) el.className = className;
        return el;
      }

      class StarWarsApp {
        static vehicleNode = el(
          'div',
          [
            el(
              'div',
              [
                el(
                  'div',
                  [
                    el(
                      'div',
                      [],
                      'pt-6 space-x-1 text-sm text-amber-300 manufacturer'
                    ),
                    el(
                      'div',
                      [
                        el('h3', [], 'text-2xl font-semibold leading-none tracking-tighter text-stone-50 name'),
                        el(
                          'div',
                          [el('p', [], 'text-sm font-medium text-stone-400 price')],
                          'flex items-center mt-6'
                        )
                      ],
                      'block mt-2 space-y-6'
                    )
                  ],
                  'flex-1'
                )
              ],
              'flex flex-col justify-between flex-1'
            )
          ],
          'flex flex-col mb-12 overflow-hidden vehicle'
        );

        static loadingIndicator = el('p', ['Loading...'], 'text-stone-50 loading-indicator');

        init = async () => {
          this.showVehicleLoadingIndicator();
          this.showStarshipLoadingIndicator();

          const [vehiclesResponse, starshipsResponse] = await Promise.allSettled([
            this.loadVehicles().catch(e => {
              console.error(e);
              return [];
            }),
            this.loadStarships()
          ]);

          if (vehiclesResponse.status === 'fulfilled') {
            const vehicles = vehiclesResponse.value.slice(0, 6).map(this.renderVehicle);
            document.getElementById('vehicles').querySelector('.loading-indicator').replaceWith(...vehicles);
          } else {
            document.getElementById('vehicles').querySelector('.loading-indicator').replaceWith('Some error happened.');
          }

          if (starshipsResponse.status === 'fulfilled') {
            const starships = starshipsResponse.value.slice(0, 6).map(this.renderVehicle);
            document.getElementById('starships').replaceChildren(...starships);
          }

          document.querySelectorAll('.vehicle').forEach(el => {
            const price = parseInt(el.querySelector('.price').textContent.split(' ')[0], 10);
            if (price > 1e6) {
              el.style.border = '2px solid gold';
            }
          });
        }

        async loadVehicles() {
          await delay();
          const res = await fetch("https://swapi.info/api/vehicles");
          return res.json();
        }

        async loadStarships() {
          await delay();
          const res2 = await fetch("https://swapi.info/api/starships");
          return res2.json();
        }

        renderVehicle({ name, manufacturer, cost_in_credits, filmNames = [] }) {
          const vehicleEl = StarWarsApp.vehicleNode.cloneNode(true);
          vehicleEl.querySelector('.name').textContent = name;
          vehicleEl.querySelector('.manufacturer').textContent = manufacturer;
          vehicleEl.querySelector('.price').textContent = `${cost_in_credits} credits`;

          return vehicleEl;
        }

        showVehicleLoadingIndicator() {
          document.getElementById('vehicles').append(StarWarsApp.loadingIndicator.cloneNode(true));
        }

        showStarshipLoadingIndicator() {
          document.getElementById('starships').append(StarWarsApp.loadingIndicator.cloneNode(true));
        }
      }

      const { init } = new StarWarsApp();
      init();
    </script>
  </body>
</html>
